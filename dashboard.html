<!-- dashboard.html (tam sayfa) -->
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Self Training • Panel</title>
  <style>
    :root{
      --bg:#f4f6f8; --card:#ffffff; --ink:#1f2937; --muted:#6b7280;
      --ok:#16a34a; --warn:#f59e0b; --danger:#ef4444; --line:#e5e7eb;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .wrap{max-width:980px;margin:32px auto;padding:12px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:18px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:18px;box-shadow:0 2px 12px rgba(0,0,0,.04)}
    h1{font-size:22px;margin:0 0 8px}
    h2{font-size:18px;margin:6px 0 12px}
    label{display:block;font-weight:600;margin:10px 0 6px}
    input,select,button,textarea{
      width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:#fff;
      font:inherit;outline:none
    }
    input:focus,select:focus,textarea:focus{border-color:#94a3b8;box-shadow:0 0 0 3px rgba(148,163,184,.25)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .btn{cursor:pointer;background:var(--ok);color:#fff;border:none}
    .btn.secondary{background:#374151}
    .note{font-size:13px;color:var(--muted)}
    .inline{display:flex;gap:8px;align-items:center}
    .pill{display:inline-block;background:#eef2ff;color:#3730a3;padding:2px 8px;border-radius:999px;font-size:12px;margin-left:6px}
    .good{color:var(--ok)} .warn{color:var(--warn)} .bad{color:var(--danger)}
    .output p{margin:6px 0}
    .kutu{background:#f8fafc;border:1px dashed var(--line);border-radius:10px;padding:12px}
    details{margin-top:6px}
    code{background:#f1f5f9;border:1px solid var(--line);padding:0 6px;border-radius:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Hoş geldiniz <span id="helloName" class="pill"></span></h1>

    <div class="grid">
      <!-- SOL: Antropometri + Hedef -->
      <section class="card">
        <h2>Antropometrik Bilgiler ve Hedef</h2>

        <div class="row">
          <div>
            <label for="age">Yaş</label>
            <input id="age" type="number" min="5" max="100" placeholder="Örn. 24" />
          </div>
          <div>
            <label for="sex">Cinsiyet</label>
            <select id="sex">
              <option value="">Seçiniz</option>
              <option value="male">Erkek</option>
              <option value="female">Kadın</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="height">Boy (santimetre)</label>
            <input id="height" type="number" min="90" max="250" placeholder="Örn. 178" />
          </div>
          <div>
            <label for="weight">Kilo (kilogram)</label>
            <input id="weight" type="number" min="20" max="300" step="0.1" placeholder="Örn. 76.5" />
          </div>
        </div>

        <details>
          <summary><strong>İsteğe bağlı ölçümler</strong> (Vücut yağ oranı ve nabız hesapları için)</summary>
          <div class="row" style="margin-top:10px">
            <div>
              <label for="waist">Bel çevresi (cm)</label>
              <input id="waist" type="number" min="40" max="200" placeholder="Göbek deliği hizası" />
            </div>
            <div>
              <label for="hip">Kalça çevresi (cm)</label>
              <input id="hip" type="number" min="50" max="220" placeholder="Kadınlarda gerekli" />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="neck">Boyun çevresi (cm)</label>
              <input id="neck" type="number" min="20" max="70" placeholder="Gırtlak altı" />
            </div>
            <div>
              <label for="rhr">Dinlenik nabız (dakikadaki atım)</label>
              <input id="rhr" type="number" min="30" max="120" placeholder="Örn. 65" />
            </div>
          </div>
          <p class="note">
            <strong>Nasıl ölçülür?</strong> Bel: göbek deliği hizası; Kalça: en geniş nokta; Boyun: gırtlak altı. Mezurayı sıkmadan, aynanın karşısında ölçün.
          </p>
        </details>

        <label for="goal" style="margin-top:12px">Hedef</label>
        <select id="goal">
          <option value="">Seçiniz</option>
          <option value="hipertrofi">Kas kütlesi artırmak (hipertrofi)</option>
          <option value="kuvvet">Maksimum kuvvet kazanmak</option>
          <option value="guc">Patlayıcılık / güç geliştirmek</option>
          <option value="yag">Vücut yağ oranını düşürmek</option>
          <option value="kardiyo">Kardiyo / kondisyon artırmak</option>
          <option value="esneklik">Esneklik ve mobilite geliştirmek</option>
          <option value="postur">Postür / duruş düzeltmek</option>
          <option value="saglik">Genel sağlık ve formda kalma</option>
          <option value="rehab">Rehabilitasyon / hafif egzersiz</option>
        </select>

        <div class="inline" style="margin-top:14px">
          <button id="calc" class="btn">Hesapla ve Kaydet</button>
          <button id="clear" class="btn secondary" title="Tüm alanları temizler">Sıfırla</button>
        </div>
        <p id="msg" class="note"></p>
      </section>

      <!-- SAĞ: Sonuçlar -->
      <section class="card">
        <h2>Özet ve Değerler</h2>
        <div class="output">
          <p><strong>Beden Kitle İndeksi (BMI)</strong>:
            <span id="bmiVal">–</span> <span id="bmiClass" class="pill"></span>
          </p>
          <p><strong>Bazal Metabolizma Hızı</strong> (günde yakacağınız kalori, <em>BMR</em>):
            <span id="bmrVal">–</span> kcal/gün
          </p>
          <div class="kutu">
            <p><strong>Maksimum Kalp Atış Hızı</strong> (yaşa göre): <span id="mhrVal">–</span> atım/dk</p>
            <p><strong>Kalp Atım Rezervi</strong> (HRR = Maksimum − Dinlenik): <span id="hrrVal">–</span></p>
            <p><strong>Hedef Nabız Bölgeleri (Karvonen)</strong></p>
            <ul id="zones" class="note" style="margin:6px 0 0 18px"></ul>
          </div>
          <p><strong>Tahmini Vücut Yağ Oranı</strong> (US Navy yöntemi): <span id="bfpVal">–</span></p>
        </div>
      </section>
    </div>

    <!-- Alt grid: Antrenman & Beslenme -->
    <div class="grid" style="margin-top:18px">
      <section class="card">
        <h2>Seçilen Hedefe Göre Antrenman Önerisi</h2>
        <div id="plan" class="kutu note">Önce bilgileri kaydedin.</div>
      </section>
      <section class="card">
        <h2>Kısa Beslenme İpucu</h2>
        <div id="nutrition" class="kutu note">Hedef seçildiğinde burada görünecek.</div>
      </section>
    </div>

    <p class="note" style="margin-top:10px">
      Bu hesaplayıcı bilgilendirme amaçlıdır; sağlık durumunuz için hekim görüşü alınız.
    </p>
  </div>

  <script>
    // Yardımcılar
    const byId = id => document.getElementById(id);
    const round1 = n => Math.round(n*10)/10;
    const clamp = (n, a, b) => Math.min(Math.max(n, a), b);

    // Kullanıcı adını selamla (signup'tan geldiyse)
    (function greet(){
      try{
        const u = JSON.parse(localStorage.getItem("user")||"{}");
        if(u && u.name){ byId("helloName").textContent = u.name; }
      }catch(_){}
    })();

    // Kaydedilmiş profil varsa doldur
    (function loadSaved(){
      try{
        const p = JSON.parse(localStorage.getItem("profile")||"{}");
        for(const k of ["age","sex","height","weight","waist","hip","neck","rhr","goal"]){
          if(p[k]!==undefined && byId(k)){ byId(k).value = p[k]; }
        }
      }catch(_){}
    })();

    // BMI sınıfı
    function bmiClass(bmi){
      if(bmi < 18.5) return ["Zayıf","bad"];
      if(bmi < 25)   return ["Normal","good"];
      if(bmi < 30)   return ["Fazla kilolu","warn"];
      return ["Obez","bad"];
    }

    // BMR (Mifflin-St Jeor)
    function calcBMR(sex, kg, cm, age){
      if(!sex||!kg||!cm||!age) return null;
      return Math.round(sex==="male"
        ? 10*kg + 6.25*cm - 5*age + 5
        : 10*kg + 6.25*cm - 5*age - 161);
    }

    // US Navy vücut yağ oranı (cm)
    function calcBFP(sex, height, neck, waist, hip){
      if(!sex || !height || !neck || !waist) return null;
      const log10 = Math.log10 || (x=>Math.log(x)/Math.LN10);
      if(sex==="male"){
        const v = 86.010*log10(waist - neck) - 70.041*log10(height) + 36.76;
        return round1(v);
      }else{
        if(!hip) return null;
        const v = 163.205*log10(waist + hip - neck) - 97.684*log10(height) - 78.387;
        return round1(v);
      }
    }

    // Karvonen bölgeleri
    function karvonenZones(age, rhr){
      if(!age) return null;
      const mhr = 220 - Number(age);
      const resting = rhr ? Number(rhr) : 70; // boşsa varsayılan
      const hrr = mhr - resting;
      const ranges = [
        {name:"Bölge 1 (çok hafif) %50–60", lo:.50, hi:.60},
        {name:"Bölge 2 (hafif) %60–70", lo:.60, hi:.70},
        {name:"Bölge 3 (orta) %70–80", lo:.70, hi:.80},
        {name:"Bölge 4 (yüksek) %80–90", lo:.80, hi:.90},
        {name:"Bölge 5 (maks.) %90–100", lo:.90, hi:1.00},
      ];
      ranges.forEach(z=>{
        z.from = Math.round(resting + z.lo*hrr);
        z.to   = Math.round(resting + z.hi*hrr);
      });
      return {mhr, hrr, resting, ranges};
    }

    // Hedefe göre kısa plan ve beslenme
    function goalTemplates(goal){
      const data = {
        hipertrofi:{
          plan:"Haftada 3–5 gün. Bölgesel veya tüm vücut. Set x tekrar: 3–5 set × 8–12 tekrar. Dinlenme 60–90 sn. Tempo kontrollü (eksantrik 2–3 sn).",
          nut :"Günlük protein ~1.6–2.2 g/kg, hafif kalori fazlası (+200–300 kcal). Öğün başına 25–40 g protein."
        },
        kuvvet:{
          plan:"Haftada 3–4 gün. Çok eklemli hareketler (squat, deadlift, bench, overhead). 3–6 set × 1–5 tekrar, %80–95 1RM. Dinlenme 2–4 dk.",
          nut :"Protein 1.8–2.2 g/kg; karbonhidrat antrenman günleri daha yüksek. Yeterli uyku (7–9 saat)."
        },
        guc:{
          plan:"Haftada 2–4 gün. Plyometrik + balistik + halter varyasyonları. 3–5 set × 3–6 tekrar, tam patlayıcı. Dinlenme 90–180 sn.",
          nut :"Antrenman öncesi kolay sindirilen karbonhidrat; kreatin düşün (doktor/uzman onayıyla)."
        },
        yag:{
          plan:"Haftada 4–6 gün. Ağırlık + kardiyo kombinasyon. Ağırlık: 3–4 set × 10–15 tekrar, dinlenme 30–60 sn. Kardiyo: 25–40 dk, Bölge 2–3.",
          nut :"Kalori açığı −300/−500 kcal. Protein 1.6–2.2 g/kg. Şekerli içecekleri ve sıvı kalorileri azalt."
        },
        kardiyo:{
          plan:"Haftada 3–5 gün. 20–45 dk aralığında Bölge 2–3 dayanıklılık; haftada 1 gün 6–10 × (1 dk hızlı + 1–2 dk kolay).",
          nut :"Karbonhidrat alımını antrenman etrafında planla; yeterli sıvı ve elektrolit."
        },
        esneklik:{
          plan:"Her gün 10–20 dk. Dinamik ısınma + hareket açıklığı (kalça, omuz, torakal omurga). Antrenman sonrası 30–60 sn statik germe.",
          nut :"Bağ dokusu sağlığı için yeterli protein ve omega-3; düzenli su tüketimi."
        },
        postur:{
          plan:"Haftada 3–5 gün. Core stabilizasyon, sırt orta-alt aktivasyon, kalça ekstansörleri. Gün içi postür molaları (saatte 2–3 dk).",
          nut :"Düşük inflamasyonlu beslenme; uzun süreli oturmada su molaları."
        },
        saglik:{
          plan:"Haftada 3+ gün, 30–45 dk orta yoğunluk + 2 gün temel kuvvet. Günlük adım hedefi 7–10 bin.",
          nut :"Sebze-meyve, tam tahıl, kaliteli protein. Su: günde ~30–35 ml/kg."
        },
        rehab:{
          plan:"Uzman onayıyla. Ağrısız aralıkta izometrik / düşük yük. 2–4 set × 10–20 tekrar. Tempo yavaş ve kontrollü.",
          nut :"Yeterli protein ve mikronutrient; iyileşme için uyku önceliklendirilir."
        }
      };
      return data[goal] || {plan:"Önce hedef seçin.", nut:"—"};
    }

    // Hesapla ve yaz
    function compute(){
      const age = Number(byId("age").value);
      const sex = byId("sex").value;
      const height = Number(byId("height").value);
      const weight = Number(byId("weight").value);
      const waist = Number(byId("waist").value);
      const hip = Number(byId("hip").value);
      const neck = Number(byId("neck").value);
      const rhr = Number(byId("rhr").value);
      const goal = byId("goal").value;

      if(!age || !sex || !height || !weight){
        byId("msg").textContent = "Lütfen yaş, cinsiyet, boy ve kilo alanlarını doldurun.";
        return;
      }

      // Kaydet
      const profile = {age,sex,height,weight,waist,hip,neck,rhr,goal};
      localStorage.setItem("profile", JSON.stringify(profile));
      byId("msg").textContent = "Bilgiler kaydedildi ✅";

      // BMI
      const bmi = weight / Math.pow(height/100,2);
      const [cls, tone] = bmiClass(bmi);
      byId("bmiVal").textContent = round1(bmi);
      const tag = byId("bmiClass");
      tag.textContent = cls; tag.className = "pill " + (tone||"");

      // BMR
      const bmr = calcBMR(sex, weight, height, age);
      byId("bmrVal").textContent = bmr? bmr : "—";

      // Karvonen
      const kz = karvonenZones(age, rhr);
      const zonesEl = byId("zones"); zonesEl.innerHTML = "";
      if(kz){
        byId("mhrVal").textContent = kz.mhr;
        byId("hrrVal").textContent = kz.hrr + " (Dinlenik: " + kz.resting + ")";
        kz.ranges.forEach(z=>{
          const li = document.createElement("li");
          li.textContent = `${z.name}: ${z.from}–${z.to} atım/dk`;
          zonesEl.appendChild(li);
        });
      }else{
        byId("mhrVal").textContent = "—"; byId("hrrVal").textContent = "—";
      }

      // BFP
      const bfp = calcBFP(sex, height, neck, waist, hip);
      byId("bfpVal").textContent = (bfp!==null && isFinite(bfp)) ? (bfp+" %") : "—";

      // Plan + beslenme
      const tpl = goalTemplates(goal);
      byId("plan").textContent = tpl.plan;
      byId("nutrition").textContent = tpl.nut;
    }

    // Sıfırla
    function clearAll(){
      for(const id of ["age","sex","height","weight","waist","hip","neck","rhr","goal"]){
        const el = byId(id); if(!el) continue;
        if(el.tagName==="SELECT") el.selectedIndex = 0; else el.value = "";
      }
      ["bmiVal","bmiClass","bmrVal","mhrVal","hrrVal","bfpVal","plan","nutrition","msg"].forEach(id=>{
        const el = byId(id);
        if(id==="plan"||id==="nutrition") el.textContent="—";
        else if(id==="bmiClass") { el.textContent=""; el.className="pill"; }
        else el.textContent="—";
      });
      byId("zones").innerHTML="";
      localStorage.removeItem("profile");
    }

    byId("calc").addEventListener("click", compute);
    byId("clear").addEventListener("click", clearAll);
  </script>
</body>
</html>
