<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Panel • Self Training</title>
  <link rel="stylesheet" href="./assets/css/styles.css">
</head>
<body class="bg">
  <div class="wrap">
    <div class="card card-slim">
      <div class="topbar">
        <button class="link" onclick="history.back()">&larr; Geri</button>
        <div class="small">Giriş: <span id="who">—</span></div>
        <button class="link" onclick="signOutAndGo()">Çıkış Yap</button>
      </div>
      <h2>Hedef & Bilgi</h2>

      <div class="row">
        <label>Hedef(ler)ini seç <span class="small">(maks. 3)</span></label>
        <div id="goals" class="chips"></div>
        <div class="small">Seçtiklerin, ölçüm/test önerilerini belirler.</div>
      </div>

      <div class="grid2">
        <div class="row">
          <label>Spor geçmişi</label>
          <select id="history">
            <option value="">Seçiniz…</option>
            <option>Hiç yok</option>
            <option>Okul/amatör</option>
            <option>Düzenli rekreasyonel</option>
            <option>Yarışmacı/pro</option>
          </select>
        </div>
        <div class="row">
          <label>Seviye</label>
          <select id="level"><option>Başlangıç</option><option>Orta</option><option>İleri</option></select>
        </div>
      </div>

      <div class="row">
        <label>Sakatlık / sağlık</label>
        <div class="chips" id="injuryChips"></div>
        <textarea id="injuryNote" placeholder="Tıbbi tanı yerine genel tarif (ör. bel fıtığı, sağ diz ACL öyküsü)…"></textarea>
      </div>

      <div class="sticky-foot"><button id="next" class="btn">İleri</button></div>
    </div>
  </div>

  <script src="./assets/js/common.js"></script>
  <script>
  const GOAL_OPTIONS = [
    ['fatloss','Yağ Yakımı / Kilo Verme'],
    ['muscle','Kas Kazanımı / Kuvvet'],
    ['endurance','Dayanıklılık / Koşu'],
    ['mobility','Esneklik / Mobilite'],
    ['home','Evde Ekipmansız'],
    ['posture','Duruş / Core'],
    ['sport','Branş Sporu (tenis/yüzme)']
  ];
  const INJ = ['Yok','Bel','Diz','Omuz','Boyun','Ayak bileği'];

  const gWrap = $('#goals');
  GOAL_OPTIONS.forEach(([key,label])=>{
    const b=document.createElement('button'); b.type='button';
    b.className='chip'; b.textContent=label; b.dataset.key=key;
    b.onclick=()=>{
      const act=$$('.chip.active',gWrap);
      if(!b.classList.contains('active') && act.length>=3){ toast('Maksimum 3 hedef.'); return; }
      b.classList.toggle('active');
    };
    gWrap.appendChild(b);
  });

  const injWrap = $('#injuryChips');
  INJ.forEach(label=>{
    const b=document.createElement('button'); b.type='button'; b.className='chip'; b.textContent=label;
    b.onclick=()=>b.classList.toggle('active');
    injWrap.appendChild(b);
  });

  const user = (window.firebase?.auth?.currentUser) || store.get('demo_user');
  $('#who').textContent = user?.displayName || user?.name || '—';

  $('#next').onclick = ()=>{
    const goals = $$('.chip.active', gWrap).map(b=>({key:b.dataset.key,label:b.textContent}));
    if(goals.length===0){ toast('En az 1 hedef seç.'); return; }
    const profile = {
      goals,
      history: $('#history').value,
      level: $('#level').value,
      injuries: $$('.chip.active', injWrap).map(b=>b.textContent),
      injuryNote: $('#injuryNote').value.trim()
    };
    store.set('st_profile_v1', profile);
    location.href='./metrics.html';
  };
  </script>
</body>
</html>
